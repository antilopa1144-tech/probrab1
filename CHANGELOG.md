# Changelog

Все значимые изменения в проекте Мастерок.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/).

## [1.4.0] - 2026-02-21

### Добавлено
- **AI-помощник Михалыч**: чат-бот прораба с 30-летним стажем — отвечает на вопросы по стройке, подсказывает материалы, нормы расхода и порядок работ
  - Экспертиза дизайнера интерьеров: советы по сочетанию цветов, фактур, планировке
  - Жёсткий, но справедливый характер с фирменным юмором
  - Конкретные рекомендации: марка, количество, толщина, шаг, способ крепления
  - Работает через OpenRouter API (Google Gemini Flash), SSE-стриминг
  - Лимит: 20 запросов/день, 10 запросов/час
- **Калькулятор комнаты**: комплексный расчёт всех материалов для ремонта одного помещения (штукатурка, шпаклёвка, краска, обои, ламинат, плитка, грунтовка)
- **Связанные калькуляторы**: после расчёта показываются релевантные калькуляторы (плитка → затирка → клей, штукатурка → шпаклёвка → краска)
- **Калькулятор затирки плитки**: 3 типа (цементная, эпоксидная, полиуретановая) с расчётом по формулам из техкарт производителей
- **Инструменты** в каталоге:
  - Калькулятор площади комнаты (пол, потолок, стены, проёмы)
  - Простой арифметический калькулятор (+, −, ×, ÷, %, ±)
- **PDF-экспорт**: сохранение результатов расчёта в PDF с кириллицей (Roboto), локальное сохранение в Downloads
- **ReviewService**: интеграция с RuStore In-App Review
- **TrackerService**: аналитика MyTracker

### Изменено
- **Штукатурка**: тип основания (бетон/кирпич/газоблок), ровность стен, авто-подключение сетки при слое >30 мм
- **Плитка**: аддитивные отходы (паттерн + сложность + размер), глубина шва по размеру, крестики ×1.2
- **Ламинат**: масштабирование запаса по площади (<15 м² = больше подрезки), паттерны укладки
- **Обои**: клей и грунтовка в результатах, тип обоев влияет на расход клея
- **Краска**: подготовка поверхности, интенсивность цвета, грунтовка всегда в результатах; поверхности локализованы
- **Бетон**: 7 марок (М100–М400), пропорции цемент/песок/щебень/вода по марке
- **Утеплитель (минвата)**: крепёж по толщине (4–10 шт/м²) и плотности; добавлены ключи локализации
- **Гипсокартон**: форма стены, соединители при h>3 м, рекомендация минваты для перегородок
- **Кирпич**: условия работ (ветер/холод/жара), кладочная сетка через 3–5 рядов
- **Декоративный камень**: подключён v2 с выбором типа (гипсовый 3 кг/м², бетонный 5 кг/м², натуральный 7 кг/м²)
- **Забор**: шаг высоты 1.0 → 0.1 м, подключён CalculateFenceV2
- **ОСБ/Фанера**: grid-layout для inputMode=0, ориентация листа (авто/горизонт./вертикал.)
- **Тёплый пол**: мощность 150 Вт/м² по СП 60.13330.2020, шаг трубы ванная 100 мм, демпферная лента по периметру, ИК плёнка с отступами 30 см от стен
- **Фасадные панели**: добавлены фиброцементные и HPL, панели считаются поштучно, ветрозащитная мембрана с нахлёстом 15%
- **Шпаклёвка**: выбор поверхности (стены/потолок), выбор фасовки ChoiceChip, новые материалы (Knauf Унифлотт, Semin, VGT Premium)
- **Плиточный клей**: расширен с 16 до 33 брендов (Weber-Vetonit, Mapei, Bergauf, Litokol Hyperflex, Unis U-300, Knauf Мрамор и др.)
- **Наливной пол Ceresit**: добавлены CN 178, CN 68 Nivelir, CN 76, CN 88
- **Настройки**: убраны нерабочие секции «Регион и единицы» и «Язык»

### Исправлено
- **Аудит 68 калькуляторов** — 7 критичных формул:
  - Отопление: мощность через объём × 41 Вт/м³ (СНиП 41-01-2003)
  - Декоративная штукатурка: 3 типа (фактурная/структурная/венецианская)
  - Облицовочный кирпич: раствор по lookup-таблице СНиП 3.03.01-87
  - Гидроизоляция: дефолт высоты стен 1.2 м (СП 29.13330)
  - Краска: скотч по периметру комнаты + проёмы
  - Обои: раппорт ceil() без лишнего +1
  - Лестница: 3 косоура при ширине >1.2 м
- **Локализация**: исправлены 50+ отсутствующих ключей в ru.json (покраска, комната, стяжка, штукатурка, ОСБ, ламинат, утеплитель, забор, декоративный камень)
- **Покраска**: snake_case → camelCase (surfacePrep, colorIntensity) — ключи не отображались
- **Дубликаты JSON-ключей**: hint.laminate (терялся diagonal_high_waste), plaster_pro.section
- **Дубликат ключа "result"** в ru.json — второй перезаписывал первый, теряя 400+ переводов
- **PDF-шрифты**: Roboto Regular/Bold были HTML-страницами GitHub → заменены настоящими TTF
- **Запас обоев**: удалён из калькулятора (пользователь сам решает)
- **Белые карточки**: 5 мест в wood_screen.dart с Colors.white → theme-aware
- **Ползунки**: decimals по step (<1 = 1 знак), min/max labels с decimals, inactiveTrackColor theme-aware

### Дизайн-система
- **AppColors**: единый источник цветов для обеих тем, `AppColors.of(context)`
- **AppTypography**: единый источник TextStyle-констант
- **CalculatorColors / CalculatorDesignSystem**: делегируют в AppColors/AppTypography, обратная совместимость для 68+ файлов
- **Тёмная тема**: тёплые персиковые тона, улучшенный контраст
- Удалена секция `fonts:` из pubspec.yaml — UI использует системный Roboto (бандлед рендерил тоньше на Samsung)

### Техническое
- 68+ калькуляторов, 8170+ тестов, 0 failed, 0 analyze issues
- CI: рефакторинг workflow сборки
- .gitignore: покрыты все паттерны isar temp файлов
- README: обновлены данные, контакты, убраны неактуальные ссылки

---

## [1.1.0] - 2026-01-28

### Исправлено
- **Кассетный потолок**: профили теперь корректно масштабируются с площадью (переход на V2 калькулятор с нормативами СНиП)
- **Шпаклёвка**: добавлен выбор класса качества (Q1-Q2 эконом / Q3 стандарт / Q4 премиум) согласно СНиП 3.04.01-87
- **Обшивка ГКЛ**: удалён некорректный режим "По размерам", оставлен только "По площади"
- **ЭППС утеплитель**: убрана лишняя пароизоляция для экструдированного пенополистирола (ЭППС паронепроницаем по СП 50.13330.2012)
- **ИК тёплый пол**: добавлен выбор ширины плёнки (50/80/100 см) с выводом результата в погонных метрах

### Изменено
- Улучшена обработка ошибок Firebase — приложение продолжает работу даже при недоступности сервисов аналитики

### Удалено
- Удалены неиспользуемые экраны калькуляторов (V1 версии)
- Удалена документация разработчика из корня проекта
- Удалены устаревшие миграционные скрипты

### Техническое
- Очистка кодовой базы: удалены дублирующиеся файлы и неиспользуемый код
- Добавлена защита от крашей при недоступности Firebase Performance
- Исправлены тесты для удалённых компонентов

---

## [1.0.0] - 2026-01-25

### Первый релиз в RuStore

#### Добавлено
- 50+ калькуляторов строительных материалов
- Категории: стены, полы, потолки, фундамент, кровля, отделка
- Чек-листы для ремонта (ванная, кухня, гостиная и др.)
- Конвертер единиц измерения
- Избранные калькуляторы
- Поиск по калькуляторам
- История расчётов
- Тёмная и светлая тема
- Работа оффлайн

#### Калькуляторы
- Ламинат, линолеум, плитка, паркет
- Обои, краска, штукатурка, шпаклёвка
- Гипсокартон, вагонка
- Стяжка пола, наливной пол, тёплый пол
- Натяжной потолок, потолок Армстронг
- Кирпич, газобетон, пеноблоки
- Бетон, арматура, фундамент
- И многое другое...

---
